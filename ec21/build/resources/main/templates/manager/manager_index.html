<!DOCTYPE html>
<html lang="en" xmlns:th="http://thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <!-- Meta, title, CSS, favicons, etc. -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/png" th:href="@{/production/images/ec21logo.png}">

  <title>ec21 관리자 페이지</title>
  <!-- Web Font -->
  <link
    href="https://fonts.googleapis.com/css?family=Poppins:200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap"
    rel="stylesheet">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+KR&display=swap" rel="stylesheet">

  <!-- Bootstrap -->
  <link th:href="@{/vendors/bootstrap/dist/css/bootstrap.min.css}" rel="stylesheet">
  <!-- Font Awesome -->
  <link th:href="@{/vendors/font-awesome/css/font-awesome.min.css}" rel="stylesheet">
  <!-- NProgress -->
  <link th:href="@{/vendors/nprogress/nprogress.css}" rel="stylesheet">
  <!-- iCheck -->
  <link th:href="@{/vendors/iCheck/skins/flat/green.css}" rel="stylesheet">

  <!-- bootstrap-progressbar -->
  <link th:href="@{/vendors/bootstrap-progressbar/css/bootstrap-progressbar-3.3.4.min.css}" rel="stylesheet">
  <!-- JQVMap -->
  <link th:href="@{/vendors/jqvmap/dist/jqvmap.min.css}" rel="stylesheet">
  <!-- bootstrap-daterangepicker -->
  <link th:href="@{/vendors/bootstrap-daterangepicker/daterangepicker.css}" rel="stylesheet">

  <!-- Custom Theme Style -->
  <link th:href="@{/build/css/custom.css}" rel="stylesheet">
<<<<<<< HEAD
  <script th:src="@{/script/jquery-3.7.1.min.js}"></script>
  <script>

    $(document).ready(function () {
      // 현재 날짜와 달의 첫 날짜를 계산합니다.
      var currentDate = new Date();
      var firstDayOfMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);

      // input 태그에 날짜를 설정합니다.
      $('#startDate').val(firstDayOfMonth.toISOString().split('T')[0]);
      $('#endDate').val(currentDate.toISOString().split('T')[0]);

      // 페이지 로드 시 차트를 업데이트합니다.
      updateCharts();

      // 'Update Charts' 버튼에 이벤트 리스너를 설정합니다.
      // 사용자가 버튼을 클릭하면 updateCharts 함수가 실행됩니다.
      $('#startDate, #endDate').on('change', function () {
        updateCharts();
      });
    });

    // 차트 인스턴스를 저장할 변수 선언
    var lineChartInstance;
    var doughnutChartInstance;

    function updateCharts() {
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;

      if (!startDate || !endDate) {
        alert("Please select both start and end dates.");
        return;
      }

      // AJAX 요청을 보냅니다.
      $.ajax({
        url: "/manager/board/categoryProductCountByDateRange",
        type: "GET",
        data: {
          startDate: startDate,
          endDate: endDate
        },
        success: function (response) {
          // 라인 차트 업데이트
          updateLineChart(response);

          // 도넛 차트 업데이트 (도넛 차트 업데이트 함수는 정의되어 있어야 합니다)
          updateDoughnutChart(response);
        },
        error: function (xhr, status, error) {
          console.error("Error fetching data:", xhr, status, error);
        }
      });
    }

    function updateLineChart(data) {
      // 날짜별로 데이터를 집계
      let dateCounts = data.reduce((acc, item) => {
        let date = item.date.split('T')[0]; // ISO 문자열에서 날짜 부분만 가져옵니다.
        acc[date] = (acc[date] || 0) + item.count;
        return acc;
      }, {});

      // 날짜와 카운트를 배열로 변환
      let dates = Object.keys(dateCounts).sort();
      let counts = dates.map(date => dateCounts[date]);

      // 차트 데이터 업데이트
      const ctx = document.getElementById('lineChart').getContext('2d');
      if (lineChartInstance) {
        lineChartInstance.destroy(); // 기존 차트가 있다면 제거
      }
      lineChartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: dates, // 날짜 배열
          datasets: [{
            label: "",
            data: counts, // 카운트 배열
            fill: false,
            // borderColor: 'rgba(54, 162, 235, 1)',
            tension: 0.4
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true
            }
          },
          tooltips: {
            callbacks: {
              title: function () {
                return ''; // 이것은 툴팁의 제목을 숨깁니다.
              },
              label: function (tooltipItem, data) {
                return `Count: ${tooltipItem.yLabel}`;
              }
            }
          },
          legend: {
            display: false // 이것은 범례를 숨깁니다.
          }
        }
      });
    }


    function updateDoughnutChart(data) {
      console.log(data);
      // 카테고리별로 데이터를 집계합니다.
      const categoryData = data.reduce((acc, item) => {
        const category = item.category;
        const count = item.count;
        if (!acc[category]) {
          acc[category] = 0;
        }
        acc[category] += count;
        return acc;
      }, {});

      // 차트의 라벨과 데이터를 추출합니다.
      const chartLabels = Object.keys(categoryData);
      const chartData = chartLabels.map(label => categoryData[label]);

      const ctx = document.getElementById('doughnutChart').getContext('2d');

      // 기존 차트가 있다면 제거
      if (doughnutChartInstance) {
        doughnutChartInstance.destroy();
      }

      // 도넛 차트 생성
      doughnutChartInstance = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: chartLabels,
          datasets: [{
            label: 'Category Counts',
            data: chartData,
            backgroundColor: [
              'rgba(64, 162, 227, 0.8)',
              'rgba(255, 246, 233, 0.8)',
              'rgba(13, 146, 118, 0.8)',
              'rgba(255, 206, 86, 0.8)',
              'rgba(187, 226, 236, 0.8)',
              // 추가 색상...
            ],
            borderColor: [
              'rgba(64, 162, 227, 1)',
              'rgba(255, 246, 233, 1)',
              'rgba(13, 146, 118, 1)',
              'rgba(255, 206, 86, 1)',
              'rgba(187, 226, 236, 1)',

            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true // 비율을 유지하도록 변경
        },
        tooltips: {
          callbacks: {
            title: function () {
              return ''; // 이것은 툴팁의 제목을 숨깁니다.
            }
          }
        },
        legend: {
          display: false // 이것은 범례를 숨깁니다.
        }
      });
    }



=======

  <!-- 240413 dy : JQuery 파일 추가 및 count관련 ajax 처리 -->
  <script th:src="@{/script/jquery-3.7.1.min.js}"></script>
  <script>
>>>>>>> 2c2a42ee6a8eff8b9e73a559c2d5a90d2cc83d01
    $(function () {
      init();
    })

    function init() {
      $.ajax({
        url: "/manager/count",
        method: "get",
        success: function (resp) {
          $("#todayRegisteredProd").html(resp["todayRegisteredProd"]);
          $("#todayWeirdProd").html(resp["todayWeirdProd"]);
          $("#todayRegisteredCustomer").html(resp["todayRegisteredCustomer"]);
          $("#unprocessedReport").html(resp["unprocessedReport"]);
        }
      });

      // 일자별 등록한 상품개수 확인 
      $.ajax({
        url: "/manager/board/registerProductCount",
        method: "get",
        success: function (data) {
          // data 출력 
          // console.log("Received data from /manager/board/registerProductCount:", data);

          // createDate만 담은 배열 생성
          var createDates = data.map(function (item) {
            return item.createDate;
          });

          // count만 담은 배열 생성
          var counts = data.map(function (item) {
            return item.count;
          });

          // createDate, count 출력
          // console.log("Create Dates:", createDates);
          // console.log("Counts:", counts);

          new Chart(document.getElementById("registerProduct"), {
            type: 'line',
            data: {
              labels: createDates,
              datasets: [{
<<<<<<< HEAD
                label: "전체 상품 등록 수",
                borderColor: 'rgba(54, 162, 235, 1)', // 파란색 선
                backgroundColor: 'rgba(54, 162, 235, 0.2)', // 파란색 배경 (선 아래 채우기)
                pointBorderColor: 'rgba(54, 162, 235, 1)', // 파란색 포인트 테두리
                pointBackgroundColor: 'rgba(54, 162, 235, 1)', // 파란색 포인트 배경
                pointHoverBackgroundColor: '#fff', // 포인트 호버 배경
                pointHoverBorderColor: 'rgba(220,220,220,1)', // 포인트 호버 테두리
                pointBorderWidth: 1,
                data: counts,
                lineTension: 0.4
=======
                label: "My First dataset",
                backgroundColor: "rgba(38, 185, 154, 0.31)",
                borderColor: "rgba(38, 185, 154, 0.7)",
                pointBorderColor: "rgba(38, 185, 154, 0.7)",
                pointBackgroundColor: "rgba(38, 185, 154, 0.7)",
                pointHoverBackgroundColor: "#fff",
                pointHoverBorderColor: "rgba(220,220,220,1)",
                pointBorderWidth: 1,
                data: counts
>>>>>>> 2c2a42ee6a8eff8b9e73a559c2d5a90d2cc83d01
              }]
            }
          })

        },
        error: function (jqXHR, textStatus, errorThrown) {
          console.error("Error fetching data from /manager/board/registerProductCount:", textStatus, errorThrown);
        }
      });

      // 카테고리별 정상, 이상 상품 판별 개수
      $.ajax({
        url: "/manager/board/categoryProductCount",
        method: "get",
        success: function (data) {
          // console.log("categoryProductCount:", data);

          // 카테고리를 라벨로 변환
          const labels = Object.keys(data);

          // 이상과 정상 데이터셋 생성
          const abnormalData = labels.map(label => data[label]['이상']);
          const normalData = labels.map(label => data[label]['정상']);

          // 출력
          // console.log("labels", labels);  
          // console.log("abnormalData", abnormalData);
          // console.log("normalData", normalData);

          // barchart
          // 차트 데이터 설정
          const chartData = {
            labels: labels,
            datasets: [
              {
                label: '이상',
                data: abnormalData,
                backgroundColor: 'rgba(255, 99, 132, 0.5)'
              },
              {
                label: '정상',
                data: normalData,
                backgroundColor: 'rgba(54, 162, 235, 0.5)'
              }
            ]
          };

          // 차트 생성
<<<<<<< HEAD
          const ctx = document.getElementById('categoryProduct');
=======
          const ctx = document.getElementById('categoryProduct').getContext('2d');
>>>>>>> 2c2a42ee6a8eff8b9e73a559c2d5a90d2cc83d01
          const myChart = new Chart(ctx, {
            type: 'bar',
            data: chartData,
            options: {
              scales: {
                x: {
                  stacked: true
                },
                y: {
                  stacked: true
                }
              }
            }
          });
        },
        error: function (jqXHR, textStatus, errorThrown) {
          console.error("Error fetching data: " + textStatus, errorThrown);
        }
      });

<<<<<<< HEAD
    }


=======


    }
>>>>>>> 2c2a42ee6a8eff8b9e73a559c2d5a90d2cc83d01
  </script>

</head>

<body class="nav-md">
  <div class="container body">
    <div class="main_container">
      <div class="col-md-3 left_col">
        <div class="left_col scroll-view">
          <div class="navbar nav_title">
            <a th:href="@{/manager/manager_index}" class="site_title">
              <img th:src="@{/production/images/ec21logo.png}" alt="">
            </a>
          </div>

          <div class="clearfix"></div>

          <!-- menu profile quick info -->
          <div class="profile clearfix">
            <div class="profile_pic">
              <img th:src="@{/production/images/user.png}" alt="..." class="img-circle profile_img">
            </div>
            <div class="profile_info">
              <h2>관리자</h2>
            </div>
          </div>
          <!-- /menu profile quick info -->

          <br />

          <!-- sidebar menu -->
          <div id="sidebar-menu" class="main_menu_side hidden-print main_menu">
            <div class="menu_section">
              <ul class="nav side-menu">
                <li><a><i class="fa fa-home"></i> Home <span class="fa fa-chevron-down"></span></a>
                  <ul class="nav child_menu">
                    <li><a th:href="@{/manager/manager_index}">Dashboard</a></li>
                  </ul>
                </li>
                <li><a><i class="fa fa-edit"></i> 상품관리 <span class="fa fa-chevron-down"></span></a>
                  <ul class="nav child_menu">
                    <li><a th:href="@{/manager/productList}">전체 상품 조회</a></li>
                    <li><a th:href="@{/manager/modelPredict}">모델로 이상상품 판별</a></li>
                  </ul>
                </li>
                <li><a><i class="fa fa-users"></i> 회원관리 <span class="fa fa-chevron-down"></span></a>
                  <ul class="nav child_menu">
                    <li><a th:href="@{/manager/customerList}">전체회원</a></li>
                    <li><a th:href="@{/manager/reportedCustomerList}">신고당한회원</a></li>
                    <li><a th:href="@{/manager/blackList}">블랙리스트회원</a></li>
                  </ul>
                </li>
              </ul>
            </div>
          </div>
          <!-- /sidebar menu -->

        </div>
      </div>

      <!-- top navigation -->
      <div class="top_nav">
        <div class="nav_menu">
          <div class="nav toggle">
            <a id="menu_toggle"><i class="fa fa-bars"></i></a>
          </div>
          <nav class="nav navbar-nav">
            <ul class=" navbar-right">
              <li class="nav-item dropdown open" style="padding-left: 15px;">
                <a href="javascript:;" class="user-profile dropdown-toggle" aria-haspopup="true" id="navbarDropdown"
                  data-toggle="dropdown" aria-expanded="false">
                  <img th:src="@{/production/images/user.png}" alt="">관리자
                </a>
                <div class="dropdown-menu dropdown-usermenu pull-right" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" th:href=@{/}><i class="fa fa-home pull-right"></i> Home</a>
                  <a class="dropdown-item" th:href="@{main/login}"><i class="fa fa-sign-out pull-right"></i> Log Out</a>
                </div>
              </li>

            </ul>
          </nav>
        </div>
      </div>

      <!-- /top navigation -->

      <!-- page content -->
      <div class="right_col">

        <!-- /top tiles -->
        <!-- 상품, 회원 count -->
        <!-- 240413 dy : id값 부여하고 ajax로 값 꽂아 넣기 -->
        <div class="row" style="display: flex; justify-content: center;">
          <div class="tile_count">
            <div class="col-md-3 col-sm-4  tile_stats_count">
              <span class="count_top"><i class="fa fa-user"></i> <a th:href="@{/manager/productList}">당일 등록 상품
                  수</a></span>
              <div class="count" id="todayRegisteredProd"></div>
              <!-- 지난 주 대비 증감률-->
              <!-- <span class="count_bottom"><i class="blue"><i class="fa fa-sort-asc"></i>4% </i> From last Week</span> -->
            </div>
            <div class="col-md-3 col-sm-4  tile_stats_count">
              <span class="count_top"><i class="fa fa-clock-o"></i> <a th:href="@{/manager/modelPredict}">당일 이상상품 등록
                  수</a></span>
              <div class="count" id="todayWeirdProd"></div>
              <!-- 지난 주 대비 증감률-->
              <!-- <span class="count_bottom"><i class="blue"><i class="fa fa-sort-asc"></i>3% </i> From last Week</span> -->
            </div>
            <div class="col-md-3 col-sm-4  tile_stats_count">
              <span class="count_top"><i class="fa fa-user"></i><a th:href="@{/manager/customerList}">당일회원가입수</a>
              </span>
              <div class="count blue" id="todayRegisteredCustomer"></div>
              <!-- 지난 주 대비 증감률-->
              <!-- <span class="count_bottom"><i class="blue"><i class="fa fa-sort-asc"></i>34% </i> From last Week</span> -->
            </div>
            <div class="col-md-3 col-sm-4  tile_stats_count">
              <span class="count_top"><i class="fa fa-user"></i> <a th:href="@{/manager/reportedCustomerList}">미처리된 신고
                  개수</a></span>
              <div class="count" id="unprocessedReport"></div>
              <!-- 지난 주 대비 증감률-->
              <!-- <span class="count_bottom"><i class="red"><i class="fa fa-sort-desc"></i>12% </i> From last Week</span> -->
            </div>
          </div>
        </div>

        <br />

        <!-- 상품, 회원 count 끝 -->

<<<<<<< HEAD
        <!-- 차트 시작 -->
        <div class="row">

          <!-- 일자별 상품등록 개수 라인, 도넛 그래프-->
=======
        <div class="row">
>>>>>>> 2c2a42ee6a8eff8b9e73a559c2d5a90d2cc83d01
          <div class="col-md-12 col-sm-912  ">
            <div class=" x_panel">
              <div class="x_title">
                <h2>일자별 상품등록 개수</h2>
                <div class="clearfix"></div>
              </div>

              <div class="">
                <div class="x_content mid ">
<<<<<<< HEAD
                  <div class=" ">
                    <label for="startDate">Start Date:</label>
                    <input type="date" id="startDate">
                    <label for="endDate">End Date:</label>
                    <input type="date" id="endDate">
                    <!-- <button onclick="updateCharts()">Update Charts</button> -->
                    <div style="
                    display: flex;
                    justify-content: center;
                ">
                      <div style="width: 700px;">
                        <canvas id="lineChart"></canvas>
                      </div>
                      <div style="width: 400px; height: 400px;">
                        <canvas id="doughnutChart"></canvas>
                      </div>
                    </div>

=======
                  <div class=" linechart">
                    <!-- linechart-->
                    <canvas id="registerProduct"></canvas>
>>>>>>> 2c2a42ee6a8eff8b9e73a559c2d5a90d2cc83d01
                  </div>
                </div>
              </div>
            </div>
          </div>
<<<<<<< HEAD
          <!-- 일자별 상품등록 개수 라인, 도넛 그래프 끝 -->

          <!-- 카테고리별 이상/정상상품 판별개수 그래프 -->
=======

>>>>>>> 2c2a42ee6a8eff8b9e73a559c2d5a90d2cc83d01
          <div class="col-md-12 col-sm-912  ">
            <div class=" x_panel">
              <div class="x_title">
                <h2>카테고리별 이상/ 정상상품 판별 개수</h2>
                <div class="clearfix"></div>
              </div>

              <div class="">
                <div class="x_content mid ">
<<<<<<< HEAD
                  <div class="">
=======
                  <div class=" linechart">
>>>>>>> 2c2a42ee6a8eff8b9e73a559c2d5a90d2cc83d01
                    <!-- bar chart -->
                    <canvas id="categoryProduct"></canvas>
                  </div>
                </div>
              </div>
            </div>
          </div>
<<<<<<< HEAD
          <!-- /카테고리별 이상/정상상품 판별개수 그래프 끝-->

        </div>
        <!--/ 차트 끝-->

      </div>
    </div>
    <!-- /page content -->
=======

          <div class="col-md-12 col-sm-912 ">
            <div class="x_panel">
              <div class="x_title">
                <h2>World Map</h2>
                <div class="clearfix"></div>
              </div>
              <div class="x_content">
                <div id="echart_world_map" style="height:370px;"></div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
  <!-- /page content -->
>>>>>>> 2c2a42ee6a8eff8b9e73a559c2d5a90d2cc83d01

  </div>
  </div>

  <!-- jQuery -->
<<<<<<< HEAD

=======
  <script th:src="@{/vendors/jquery/dist/jquery.min.js}"></script>
>>>>>>> 2c2a42ee6a8eff8b9e73a559c2d5a90d2cc83d01
  <!-- Bootstrap -->
  <script th:src="@{/vendors/bootstrap/dist/js/bootstrap.bundle.min.js}"></script>
  <!-- FastClick -->
  <script th:src="@{/vendors/fastclick/lib/fastclick.js}"></script>
<<<<<<< HEAD

  <!-- Chart.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

=======
  <!-- NProgress -->
  <script th:src="@{/vendors/nprogress/nprogress.js}"></script>
  <!-- Chart.js -->
  <!-- <script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.bundle.min.js"></script> -->
  <!-- <script th:src="@{/vendors/Chart.js/dist/Chart.js}"></script> -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- gauge.js -->
  <script th:src="@{/vendors/gauge.js/dist/gauge.min.js}"></script>
>>>>>>> 2c2a42ee6a8eff8b9e73a559c2d5a90d2cc83d01
  <!-- bootstrap-progressbar -->
  <script th:src="@{/vendors/bootstrap-progressbar/bootstrap-progressbar.min.js}"></script>
  <!-- iCheck -->
  <script th:src="@{/vendors/iCheck/icheck.min.js}"></script>
<<<<<<< HEAD

=======
  <!-- Skycons -->
  <script th:src="@{/vendors/skycons/skycons.js}"></script>

  <!-- DateJS -->
  <script th:src="@{/vendors/DateJS/build/date.js}"></script>
  <!-- JQVMap -->
  <script th:src="@{/vendors/jqvmap/dist/jquery.vmap.js}"></script>
  <script th:src="@{/vendors/jqvmap/dist/maps/jquery.vmap.world.js}"></script>
  <script th:src="@{/vendors/jqvmap/examples/js/jquery.vmap.sampledata.js}"></script>
>>>>>>> 2c2a42ee6a8eff8b9e73a559c2d5a90d2cc83d01
  <!-- bootstrap-daterangepicker -->
  <script th:src="@{/vendors/moment/min/moment.min.js}"></script>

  <!-- Custom Theme Scripts -->
  <script th:src="@{/build/js/custom.js}"></script>

<<<<<<< HEAD
=======


  <!-- ECharts -->
  <script th:src="@{/vendors/echarts/dist/echarts.min.js}"></script>
  <script th:src="@{/vendors/echarts/map/js/world.js}"></script>


>>>>>>> 2c2a42ee6a8eff8b9e73a559c2d5a90d2cc83d01
</body>

</html>